{
	"prepare" : {
		"dockerfile" : {
			"type" : "path",
			"data" : ".robrt.Dockerfile"
		}
	},
	"build" : {
		"cmds" : [
			"echo $GL_ANALYTICS_UA_ID",
			"node --version",

			"cd $ROBRT_REPOSITORY_DIR",
			"git lfs pull",

			"cd $ROBRT_REPOSITORY_DIR/generator",
			"haxe -D travis build.hxml",
			"npm pack",
			"npm install -g manu*.tgz",
			"manu unit-tests",
			"mkdir -p $ROBRT_OUTPUT_DIR/bin",
			"cp manu*.tgz $ROBRT_OUTPUT_DIR/bin/",

			"cd $ROBRT_REPOSITORY_DIR",
			"cp LICENSE.md $ROBRT_OUTPUT_DIR/",
			"export DEBUG=1",
			"manu generate guide/the-guide.src .generated",

			"export DOCKER_HOST_IP=$(route -n | awk '/UG[ \t]/{print $2}')",
			"manu asset-server store $DOCKER_HOST_IP 6668 .generated/html/assets",
			"rm -rf .generated/html/assets",
			"cp -r .generated/html $ROBRT_OUTPUT_DIR/guide",
			"unset DEBUG",

			"ls -l .generated/pdf/fonts",
			"cd .generated/pdf/",
			"latexmk -lualatex -pdflatex='lualatex -interaction=nonstopmode' book.tex",
			"mkdir -p $ROBRT_OUTPUT_DIR/pdf $ROBRT_OUTPUT_DIR/guide/pdf",
			"cp book.pdf $ROBRT_OUTPUT_DIR/guide/pdf/the-brt-planning-guide.pdf",
			"cp book.log $ROBRT_OUTPUT_DIR/pdf/guide_lualatex.log"
		]
	}
}

